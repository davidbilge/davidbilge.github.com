
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Building a CXF client for a WCF webservice with SecureConversation - David Bilge – Blog</title>
  <meta name="author" content="David Bilge">

  
  <meta name="description" content="Although RESTful webservices and JSON is what everyone seems to be using nowadays, SOAP is still very present. But while SOAP itself is a very &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://davidbilge.github.com/blog/2012/08/19/building-a-cxf-client-for-a-wcf-webservice-with-secureconversation/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="David Bilge – Blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">David Bilge – Blog</a></h1>
  
    <h2>A developer's scrapbook.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:davidbilge.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Building a CXF Client for a WCF Webservice With SecureConversation</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-08-19T13:25:00+02:00" pubdate data-updated="true">Aug 19<span>th</span>, 2012</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>Although RESTful webservices and JSON is what everyone seems to be using nowadays, SOAP is still very present. But while SOAP itself is a very established standard, its addons – like WS-SecureConversation – seem to be interpreted differently by different frameworks. And apparently, this sometimes makes interoperability quite a difficult thing to accomplish (which I did, in the end).</p>

<p>But, I’m getting ahead of myself: What I wanted to accomplish was to have a Java-client talk to a .net-Webservice with WS-SecureConversation enabled. To be more specific, I decided to use <a href="http://cxf.apache.org/">Apache CXF</a> because Spring-WS does not support WS-SecureConversation, apparently (citation needed). I did not explore Metro or Axis, but they might have been valid options, too. The endpoint was created using standard WCF, as far as I know. I ran into quite the number of problems on my way to success which made me want to write this blog post.</p>

<p>The important parts were:</p>

<ol>
<li>Importing the public key from the WSDL into a keystore</li>
<li>Using the “.sct” suffix in the CXF configuration</li>
<li>Dectivating “chunking”</li>
<li>Using the infamous <a href="http://www.oracle.com/technetwork/java/javase/downloads/jce-6-download-429243.html">Java Cryptography Extension (JCE) Unlimited Strength Jurisdiction Policy Files</a></li>
<li>Having the endpoint’s operator deactivate <a href="http://en.wikipedia.org/wiki/Message_Transmission_Optimization_Mechanism">MTOM</a></li>
</ol>


<h2>Public key from WSDL to keystore</h2>

<p>WCF embeds the public key used for encryption into the WSDL. Alas, CXF does not recognize that, so I had to import that key into a keystore and provide that to CXF. The snippet from the WSDL looks something like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;wsdl:port</span> <span class="na">name=</span><span class="s">&quot;PortName&quot;</span> <span class="na">binding=</span><span class="s">&quot;tns:wsPortName&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;soap12:address</span> <span class="na">location=</span><span class="s">&quot;http://...&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;wsa10:EndpointReference&gt;</span>
</span><span class='line'>      <span class="nt">&lt;wsa10:Address&gt;</span>...
</span><span class='line'>      <span class="nt">&lt;/wsa10:Address&gt;</span>
</span><span class='line'>      <span class="nt">&lt;Identity</span> <span class="na">xmlns=</span><span class="s">&quot;http://schemas.xmlsoap.org/ws/2006/02/addressingidentity&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>          <span class="nt">&lt;KeyInfo</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/2000/09/xmldsig#&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>              <span class="nt">&lt;X509Data&gt;</span>
</span><span class='line'>                  <span class="nt">&lt;X509Certificate&gt;</span>MIIHm[...]2Ij5wXI=<span class="nt">&lt;/X509Certificate&gt;</span>
</span><span class='line'>              <span class="nt">&lt;/X509Data&gt;</span>
</span><span class='line'>          <span class="nt">&lt;/KeyInfo&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/Identity&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/wsa10:EndpointReference&gt;</span>
</span><span class='line'><span class="nt">&lt;/wsdl:port&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>What I did was putting the X509 certificate into a standard keyfile (I called it <code>certFromWsdl.cer</code>) like this:</p>

<pre><code>-----BEGIN CERTIFICATE-----
MIIHmTCCBYGgAwIBAgIKSPx66QAAAAAETTANBgkqhkiG9w0BAQUFADBJMRUwEwYKCZImiZPyLGQB
[...]
9c9RNCY22Ij5wXI=
-----END CERTIFICATE-----
</code></pre>

<p>and import it into a java keystore using <a href="http://docs.oracle.com/javase/6/docs/technotes/tools/windows/keytool.html">keytool</a> like this:</p>

<pre><code>$ keytool -importcert -trustcacerts -alias servicekey -keystore my-keystore.jks -storepass mystorepass -file certFromWsdl.cer
</code></pre>

<p>The keystore will automatically be created if it did not exist.</p>

<p>Now, to make CXF recognize the keystore, I used a <code>.properties</code>-file. So, I put a file called <code>clientKeystore.properties</code> on my classpath that looks like this:</p>

<figure class='code'><figcaption><span>clientKeystore.properties</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='properties'><span class='line'><span class="na">org.apache.ws.security.crypto.merlin.keystore.file</span><span class="o">=</span><span class="s">my-keystore.jks</span>
</span><span class='line'><span class="na">org.apache.ws.security.crypto.merlin.keystore.password</span><span class="o">=</span><span class="s">mystorepass</span>
</span><span class='line'><span class="na">org.apache.ws.security.crypto.merlin.keystore.type</span><span class="o">=</span><span class="s">jks</span>
</span><span class='line'><span class="na">org.apache.ws.security.crypto.merlin.keystore.alias</span><span class="o">=</span><span class="s">servicekey</span>
</span></code></pre></td></tr></table></div></figure>


<p>
Now, when creating my client object, I put the appropriate parameter into the port’s request context:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">URL</span> <span class="n">wsdlLocation</span> <span class="o">=</span> <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">wsdlLocation</span><span class="o">);</span>
</span><span class='line'><span class="n">EnpointName</span> <span class="n">endpointName</span> <span class="o">=</span> <span class="k">new</span> <span class="n">EnpointName</span><span class="o">(</span><span class="n">wsdlLocation</span><span class="o">);</span>
</span><span class='line'><span class="n">port</span> <span class="o">=</span> <span class="n">endpointName</span><span class="o">.</span><span class="na">getPortName</span><span class="o">();</span>
</span><span class='line'><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">ctx</span> <span class="o">=</span> <span class="o">((</span><span class="n">BindingProvider</span><span class="o">)</span> <span class="n">port</span><span class="o">).</span><span class="na">getRequestContext</span><span class="o">();</span>
</span><span class='line'><span class="n">ctx</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;ws-security.username.sct&quot;</span><span class="o">,</span> <span class="n">wssUsername</span><span class="o">);</span>
</span><span class='line'><span class="n">ctx</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;ws-security.password.sct&quot;</span><span class="o">,</span> <span class="n">wssPassword</span><span class="o">);</span>
</span><span class='line'><span class="n">ctx</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;ws-security.encryption.properties.sct&quot;</span><span class="o">,</span> <span class="s">&quot;clientKeystore.properties&quot;</span><span class="o">);</span>
</span><span class='line'><span class="n">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">ClientProxy</span><span class="o">.</span><span class="na">getClient</span><span class="o">(</span><span class="n">port</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<h2>Chunking</h2>

<p>WCF cannot deal correctly with <a href="http://cxf.apache.org/docs/client-http-transport-including-ssl-support.html#ClientHTTPTransport%28includingSSLsupport%29-ANoteAboutChunking">chunked requests</a>, i.e. requests that are not being sent in one part. What I saw was an Exception like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">Caused</span> <span class="nl">by:</span> <span class="n">java</span><span class="o">.</span><span class="na">net</span><span class="o">.</span><span class="na">SocketException</span><span class="o">:</span> <span class="n">Software</span> <span class="n">caused</span> <span class="n">connection</span> <span class="nl">abort:</span> <span class="n">recv</span> <span class="n">failed</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">java</span><span class="o">.</span><span class="na">net</span><span class="o">.</span><span class="na">SocketInputStream</span><span class="o">.</span><span class="na">socketRead0</span><span class="o">(</span><span class="n">Native</span> <span class="n">Method</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">java</span><span class="o">.</span><span class="na">net</span><span class="o">.</span><span class="na">SocketInputStream</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">Unknown</span> <span class="n">Source</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">java</span><span class="o">.</span><span class="na">io</span><span class="o">.</span><span class="na">BufferedInputStream</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">Unknown</span> <span class="n">Source</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">java</span><span class="o">.</span><span class="na">io</span><span class="o">.</span><span class="na">BufferedInputStream</span><span class="o">.</span><span class="na">read1</span><span class="o">(</span><span class="n">Unknown</span> <span class="n">Source</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">java</span><span class="o">.</span><span class="na">io</span><span class="o">.</span><span class="na">BufferedInputStream</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">Unknown</span> <span class="n">Source</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">sun</span><span class="o">.</span><span class="na">net</span><span class="o">.</span><span class="na">www</span><span class="o">.</span><span class="na">http</span><span class="o">.</span><span class="na">HttpClient</span><span class="o">.</span><span class="na">parseHTTPHeader</span><span class="o">(</span><span class="n">Unknown</span> <span class="n">Source</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">sun</span><span class="o">.</span><span class="na">net</span><span class="o">.</span><span class="na">www</span><span class="o">.</span><span class="na">http</span><span class="o">.</span><span class="na">HttpClient</span><span class="o">.</span><span class="na">parseHTTP</span><span class="o">(</span><span class="n">Unknown</span> <span class="n">Source</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">sun</span><span class="o">.</span><span class="na">net</span><span class="o">.</span><span class="na">www</span><span class="o">.</span><span class="na">protocol</span><span class="o">.</span><span class="na">http</span><span class="o">.</span><span class="na">HttpURLConnection</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">(</span><span class="n">Unknown</span> <span class="n">Source</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">java</span><span class="o">.</span><span class="na">net</span><span class="o">.</span><span class="na">HttpURLConnection</span><span class="o">.</span><span class="na">getResponseCode</span><span class="o">(</span><span class="n">Unknown</span> <span class="n">Source</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">cxf</span><span class="o">.</span><span class="na">transport</span><span class="o">.</span><span class="na">http</span><span class="o">.</span><span class="na">HTTPConduit</span><span class="o">.</span><span class="na">processRetransmit</span><span class="o">(</span><span class="n">HTTPConduit</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">1002</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">cxf</span><span class="o">.</span><span class="na">transport</span><span class="o">.</span><span class="na">http</span><span class="o">.</span><span class="na">HTTPConduit</span><span class="o">.</span><span class="na">access</span><span class="n">$400</span><span class="o">(</span><span class="n">HTTPConduit</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">148</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">cxf</span><span class="o">.</span><span class="na">transport</span><span class="o">.</span><span class="na">http</span><span class="o">.</span><span class="na">HTTPConduit</span><span class="n">$WrappedOutputStream</span><span class="o">.</span><span class="na">handleRetransmits</span><span class="o">(</span><span class="n">HTTPConduit</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">1494</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">cxf</span><span class="o">.</span><span class="na">transport</span><span class="o">.</span><span class="na">http</span><span class="o">.</span><span class="na">HTTPConduit</span><span class="n">$WrappedOutputStream</span><span class="o">.</span><span class="na">handleResponse</span><span class="o">(</span><span class="n">HTTPConduit</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">1515</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">cxf</span><span class="o">.</span><span class="na">transport</span><span class="o">.</span><span class="na">http</span><span class="o">.</span><span class="na">HTTPConduit</span><span class="n">$WrappedOutputStream</span><span class="o">.</span><span class="na">close</span><span class="o">(</span><span class="n">HTTPConduit</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">1428</span><span class="o">)</span>
</span><span class='line'>  <span class="o">...</span> <span class="mi">48</span> <span class="n">more</span>
</span></code></pre></td></tr></table></div></figure>


<p>To deactivate chunking, I had to put a “cxf.xml” into my classpath that looks like this:</p>

<figure class='code'><figcaption><span>cxf.xml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
</span><span class='line'>       <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
</span><span class='line'>       <span class="na">xmlns:http-conf=</span><span class="s">&quot;http://cxf.apache.org/transports/http/configuration&quot;</span>
</span><span class='line'>       <span class="na">xmlns:jaxws=</span><span class="s">&quot;http://cxf.apache.org/jaxws&quot;</span>
</span><span class='line'>       <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://cxf.apache.org/transports/http/configuration</span>
</span><span class='line'><span class="s">           http://cxf.apache.org/schemas/configuration/http-conf.xsd</span>
</span><span class='line'><span class="s">           http://www.springframework.org/schema/beans</span>
</span><span class='line'><span class="s">           http://www.springframework.org/schema/beans/spring-beans.xsd</span>
</span><span class='line'><span class="s">           http://cxf.apache.org/jaxws http://cxf.apache.org/schemas/jaxws.xsd&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c">&lt;!-- This file will automatically be picked up by CXF if it is named cxf.xml and placed on the classpath --&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nt">&lt;http-conf:conduit</span> <span class="na">name=</span><span class="s">&quot;*.http-conduit&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;http-conf:client</span> <span class="na">Connection=</span><span class="s">&quot;Keep-Alive&quot;</span>
</span><span class='line'>                      <span class="na">MaxRetransmits=</span><span class="s">&quot;1&quot;</span>
</span><span class='line'>                      <span class="na">AllowChunking=</span><span class="s">&quot;false&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/http-conf:conduit&gt;</span>
</span><span class='line'><span class="nt">&lt;/beans&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The file will automatically be picked up by CXF, so, although this is technically a Spring context, you do not have to load it explicitly. But, you need to place the “spring-context” library in your classpath. Using maven that would mean:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;dependency&gt;</span>
</span><span class='line'>  <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'>  <span class="nt">&lt;artifactId&gt;</span>spring-context<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'>  <span class="nt">&lt;version&gt;</span>3.0.6.RELEASE<span class="nt">&lt;/version&gt;</span>
</span><span class='line'><span class="nt">&lt;/dependency&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<h2>Deactivating MTOM</h2>

<p>It <a href="http://cxf.547215.n5.nabble.com/Signature-digest-mismatch-when-NET-supplies-MTOM-attachment-td3270961.html">looks like</a> CXF does not support talking to an endpoint with MTOM and encryption enabled.</p>

<p>I saw an exception like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">ws</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">WSSecurityException</span><span class="o">:</span> <span class="n">The</span> <span class="n">signature</span> <span class="n">or</span> <span class="n">decryption</span> <span class="n">was</span> <span class="n">invalid</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">ws</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">processor</span><span class="o">.</span><span class="na">ReferenceListProcessor</span><span class="o">.</span><span class="na">decryptEncryptedData</span><span class="o">(</span><span class="n">ReferenceListProcessor</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">314</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">ws</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">processor</span><span class="o">.</span><span class="na">ReferenceListProcessor</span><span class="o">.</span><span class="na">decryptDataRefEmbedded</span><span class="o">(</span><span class="n">ReferenceListProcessor</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">172</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">ws</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">processor</span><span class="o">.</span><span class="na">ReferenceListProcessor</span><span class="o">.</span><span class="na">handleReferenceList</span><span class="o">(</span><span class="n">ReferenceListProcessor</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">100</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">ws</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">processor</span><span class="o">.</span><span class="na">ReferenceListProcessor</span><span class="o">.</span><span class="na">handleToken</span><span class="o">(</span><span class="n">ReferenceListProcessor</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">60</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">ws</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">WSSecurityEngine</span><span class="o">.</span><span class="na">processSecurityHeader</span><span class="o">(</span><span class="n">WSSecurityEngine</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">396</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">cxf</span><span class="o">.</span><span class="na">ws</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">wss4j</span><span class="o">.</span><span class="na">WSS4JInInterceptor</span><span class="o">.</span><span class="na">handleMessage</span><span class="o">(</span><span class="n">WSS4JInInterceptor</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">289</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">cxf</span><span class="o">.</span><span class="na">ws</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">wss4j</span><span class="o">.</span><span class="na">WSS4JInInterceptor</span><span class="o">.</span><span class="na">handleMessage</span><span class="o">(</span><span class="n">WSS4JInInterceptor</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">97</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">cxf</span><span class="o">.</span><span class="na">phase</span><span class="o">.</span><span class="na">PhaseInterceptorChain</span><span class="o">.</span><span class="na">doIntercept</span><span class="o">(</span><span class="n">PhaseInterceptorChain</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">262</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">cxf</span><span class="o">.</span><span class="na">endpoint</span><span class="o">.</span><span class="na">ClientImpl</span><span class="o">.</span><span class="na">onMessage</span><span class="o">(</span><span class="n">ClientImpl</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">798</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">cxf</span><span class="o">.</span><span class="na">transport</span><span class="o">.</span><span class="na">http</span><span class="o">.</span><span class="na">HTTPConduit</span><span class="n">$WrappedOutputStream</span><span class="o">.</span><span class="na">handleResponseInternal</span><span class="o">(</span><span class="n">HTTPConduit</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">1667</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">cxf</span><span class="o">.</span><span class="na">transport</span><span class="o">.</span><span class="na">http</span><span class="o">.</span><span class="na">HTTPConduit</span><span class="n">$WrappedOutputStream</span><span class="o">.</span><span class="na">handleResponse</span><span class="o">(</span><span class="n">HTTPConduit</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">1520</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">cxf</span><span class="o">.</span><span class="na">transport</span><span class="o">.</span><span class="na">http</span><span class="o">.</span><span class="na">HTTPConduit</span><span class="n">$WrappedOutputStream</span><span class="o">.</span><span class="na">close</span><span class="o">(</span><span class="n">HTTPConduit</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">1428</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">cxf</span><span class="o">.</span><span class="na">transport</span><span class="o">.</span><span class="na">AbstractConduit</span><span class="o">.</span><span class="na">close</span><span class="o">(</span><span class="n">AbstractConduit</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">56</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">cxf</span><span class="o">.</span><span class="na">transport</span><span class="o">.</span><span class="na">http</span><span class="o">.</span><span class="na">HTTPConduit</span><span class="o">.</span><span class="na">close</span><span class="o">(</span><span class="n">HTTPConduit</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">658</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">cxf</span><span class="o">.</span><span class="na">interceptor</span><span class="o">.</span><span class="na">MessageSenderInterceptor</span><span class="n">$MessageSenderEndingInterceptor</span><span class="o">.</span><span class="na">handleMessage</span><span class="o">(</span><span class="n">MessageSenderInterceptor</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">62</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">cxf</span><span class="o">.</span><span class="na">phase</span><span class="o">.</span><span class="na">PhaseInterceptorChain</span><span class="o">.</span><span class="na">doIntercept</span><span class="o">(</span><span class="n">PhaseInterceptorChain</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">262</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">cxf</span><span class="o">.</span><span class="na">endpoint</span><span class="o">.</span><span class="na">ClientImpl</span><span class="o">.</span><span class="na">doInvoke</span><span class="o">(</span><span class="n">ClientImpl</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">532</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">cxf</span><span class="o">.</span><span class="na">endpoint</span><span class="o">.</span><span class="na">ClientImpl</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">ClientImpl</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">464</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">cxf</span><span class="o">.</span><span class="na">endpoint</span><span class="o">.</span><span class="na">ClientImpl</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">ClientImpl</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">367</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">cxf</span><span class="o">.</span><span class="na">endpoint</span><span class="o">.</span><span class="na">ClientImpl</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">ClientImpl</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">320</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">cxf</span><span class="o">.</span><span class="na">ws</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">trust</span><span class="o">.</span><span class="na">STSClient</span><span class="o">.</span><span class="na">requestSecurityToken</span><span class="o">(</span><span class="n">STSClient</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">734</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">cxf</span><span class="o">.</span><span class="na">ws</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">trust</span><span class="o">.</span><span class="na">STSClient</span><span class="o">.</span><span class="na">requestSecurityToken</span><span class="o">(</span><span class="n">STSClient</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">614</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">cxf</span><span class="o">.</span><span class="na">ws</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">trust</span><span class="o">.</span><span class="na">STSClient</span><span class="o">.</span><span class="na">requestSecurityToken</span><span class="o">(</span><span class="n">STSClient</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">606</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">cxf</span><span class="o">.</span><span class="na">ws</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">policy</span><span class="o">.</span><span class="na">interceptors</span><span class="o">.</span><span class="na">SecureConversationOutInterceptor</span><span class="o">.</span><span class="na">issueToken</span><span class="o">(</span><span class="n">SecureConversationOutInterceptor</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">159</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">cxf</span><span class="o">.</span><span class="na">ws</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">policy</span><span class="o">.</span><span class="na">interceptors</span><span class="o">.</span><span class="na">SecureConversationOutInterceptor</span><span class="o">.</span><span class="na">handleMessage</span><span class="o">(</span><span class="n">SecureConversationOutInterceptor</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">69</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">cxf</span><span class="o">.</span><span class="na">ws</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">policy</span><span class="o">.</span><span class="na">interceptors</span><span class="o">.</span><span class="na">SecureConversationOutInterceptor</span><span class="o">.</span><span class="na">handleMessage</span><span class="o">(</span><span class="n">SecureConversationOutInterceptor</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">44</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">cxf</span><span class="o">.</span><span class="na">phase</span><span class="o">.</span><span class="na">PhaseInterceptorChain</span><span class="o">.</span><span class="na">doIntercept</span><span class="o">(</span><span class="n">PhaseInterceptorChain</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">262</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">cxf</span><span class="o">.</span><span class="na">endpoint</span><span class="o">.</span><span class="na">ClientImpl</span><span class="o">.</span><span class="na">doInvoke</span><span class="o">(</span><span class="n">ClientImpl</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">532</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">cxf</span><span class="o">.</span><span class="na">endpoint</span><span class="o">.</span><span class="na">ClientImpl</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">ClientImpl</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">464</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">cxf</span><span class="o">.</span><span class="na">endpoint</span><span class="o">.</span><span class="na">ClientImpl</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">ClientImpl</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">367</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">cxf</span><span class="o">.</span><span class="na">endpoint</span><span class="o">.</span><span class="na">ClientImpl</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">ClientImpl</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">320</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">cxf</span><span class="o">.</span><span class="na">frontend</span><span class="o">.</span><span class="na">ClientProxy</span><span class="o">.</span><span class="na">invokeSync</span><span class="o">(</span><span class="n">ClientProxy</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">89</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">cxf</span><span class="o">.</span><span class="na">jaxws</span><span class="o">.</span><span class="na">JaxWsClientProxy</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">JaxWsClientProxy</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">134</span><span class="o">)</span>
</span><span class='line'>  <span class="o">...</span> <span class="mi">27</span> <span class="n">more</span>
</span><span class='line'><span class="n">Caused</span> <span class="nl">by:</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">ArrayIndexOutOfBoundsException</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">System</span><span class="o">.</span><span class="na">arraycopy</span><span class="o">(</span><span class="n">Native</span> <span class="n">Method</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">xml</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">encryption</span><span class="o">.</span><span class="na">XMLCipher</span><span class="o">.</span><span class="na">decryptToByteArray</span><span class="o">(</span><span class="n">XMLCipher</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">1750</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">xml</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">encryption</span><span class="o">.</span><span class="na">XMLCipher</span><span class="o">.</span><span class="na">decryptElement</span><span class="o">(</span><span class="n">XMLCipher</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">1612</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">xml</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">encryption</span><span class="o">.</span><span class="na">XMLCipher</span><span class="o">.</span><span class="na">decryptElementContent</span><span class="o">(</span><span class="n">XMLCipher</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">1650</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">xml</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">encryption</span><span class="o">.</span><span class="na">XMLCipher</span><span class="o">.</span><span class="na">doFinal</span><span class="o">(</span><span class="n">XMLCipher</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">978</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">ws</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">processor</span><span class="o">.</span><span class="na">ReferenceListProcessor</span><span class="o">.</span><span class="na">decryptEncryptedData</span><span class="o">(</span><span class="n">ReferenceListProcessor</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">312</span><span class="o">)</span>
</span><span class='line'>  <span class="o">...</span> <span class="mi">59</span> <span class="n">more</span>
</span></code></pre></td></tr></table></div></figure>


<p>
MTOM has to be deactivated on the server side, so it looks like you&#8217;re out of luck if you have no influence on that.</p>

<h2>Using strong security</h2>

<p>The webservice I tried to talk to had AES-256 encryption enabled. This is not supported by the default JRE/JDK installation. So I got an exception like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">ws</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">WSSecurityException</span><span class="o">:</span> <span class="n">Cannot</span> <span class="n">encrypt</span> <span class="n">data</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">ws</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">message</span><span class="o">.</span><span class="na">WSSecEncrypt</span><span class="o">.</span><span class="na">encryptElement</span><span class="o">(</span><span class="n">WSSecEncrypt</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">493</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">ws</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">message</span><span class="o">.</span><span class="na">WSSecEncrypt</span><span class="o">.</span><span class="na">doEncryption</span><span class="o">(</span><span class="n">WSSecEncrypt</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">406</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">ws</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">message</span><span class="o">.</span><span class="na">WSSecDKEncrypt</span><span class="o">.</span><span class="na">encryptForExternalRef</span><span class="o">(</span><span class="n">WSSecDKEncrypt</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">114</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">cxf</span><span class="o">.</span><span class="na">ws</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">wss4j</span><span class="o">.</span><span class="na">policyhandlers</span><span class="o">.</span><span class="na">SymmetricBindingHandler</span><span class="o">.</span><span class="na">doEncryptionDerived</span><span class="o">(</span><span class="n">SymmetricBindingHandler</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">482</span><span class="o">)</span>
</span><span class='line'>  <span class="o">...</span> <span class="mi">50</span> <span class="n">more</span>
</span><span class='line'><span class="n">Caused</span> <span class="nl">by:</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">xml</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">encryption</span><span class="o">.</span><span class="na">XMLEncryptionException</span><span class="o">:</span> <span class="n">Illegal</span> <span class="n">key</span> <span class="n">size</span> <span class="n">or</span> <span class="k">default</span> <span class="n">parameters</span>
</span><span class='line'><span class="n">Original</span> <span class="n">Exception</span> <span class="n">was</span> <span class="n">java</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">InvalidKeyException</span><span class="o">:</span> <span class="n">Illegal</span> <span class="n">key</span> <span class="n">size</span> <span class="n">or</span> <span class="k">default</span> <span class="n">parameters</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">xml</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">encryption</span><span class="o">.</span><span class="na">XMLCipher</span><span class="o">.</span><span class="na">encryptData</span><span class="o">(</span><span class="n">XMLCipher</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">1140</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">xml</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">encryption</span><span class="o">.</span><span class="na">XMLCipher</span><span class="o">.</span><span class="na">encryptData</span><span class="o">(</span><span class="n">XMLCipher</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">1081</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">xml</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">encryption</span><span class="o">.</span><span class="na">XMLCipher</span><span class="o">.</span><span class="na">encryptElementContent</span><span class="o">(</span><span class="n">XMLCipher</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">855</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">xml</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">encryption</span><span class="o">.</span><span class="na">XMLCipher</span><span class="o">.</span><span class="na">doFinal</span><span class="o">(</span><span class="n">XMLCipher</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">985</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">ws</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">message</span><span class="o">.</span><span class="na">WSSecEncrypt</span><span class="o">.</span><span class="na">encryptElement</span><span class="o">(</span><span class="n">WSSecEncrypt</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">490</span><span class="o">)</span>
</span><span class='line'>  <span class="o">...</span> <span class="mi">53</span> <span class="n">more</span>
</span><span class='line'><span class="n">Caused</span> <span class="nl">by:</span> <span class="n">java</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">InvalidKeyException</span><span class="o">:</span> <span class="n">Illegal</span> <span class="n">key</span> <span class="n">size</span> <span class="n">or</span> <span class="k">default</span> <span class="n">parameters</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">javax</span><span class="o">.</span><span class="na">crypto</span><span class="o">.</span><span class="na">Cipher</span><span class="o">.</span><span class="na">a</span><span class="o">(</span><span class="n">DashoA13</span><span class="o">*..)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">javax</span><span class="o">.</span><span class="na">crypto</span><span class="o">.</span><span class="na">Cipher</span><span class="o">.</span><span class="na">a</span><span class="o">(</span><span class="n">DashoA13</span><span class="o">*..)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">javax</span><span class="o">.</span><span class="na">crypto</span><span class="o">.</span><span class="na">Cipher</span><span class="o">.</span><span class="na">a</span><span class="o">(</span><span class="n">DashoA13</span><span class="o">*..)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">javax</span><span class="o">.</span><span class="na">crypto</span><span class="o">.</span><span class="na">Cipher</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="n">DashoA13</span><span class="o">*..)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">javax</span><span class="o">.</span><span class="na">crypto</span><span class="o">.</span><span class="na">Cipher</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="n">DashoA13</span><span class="o">*..)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">xml</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">encryption</span><span class="o">.</span><span class="na">XMLCipher</span><span class="o">.</span><span class="na">encryptData</span><span class="o">(</span><span class="n">XMLCipher</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">1137</span><span class="o">)</span>
</span><span class='line'>  <span class="o">...</span> <span class="mi">57</span> <span class="n">more</span>
</span></code></pre></td></tr></table></div></figure>


<p>The remedy to this: I downloaded the <a href="http://www.oracle.com/technetwork/java/javase/downloads/jce-6-download-429243.html">Java Cryptography Extension (JCE) Unlimited Strength Jurisdiction Policy Files</a> and just followed the instructions in the README file contained in the downloaded zip. This boils down to replacing two magic jars in your JRE installation. It just sucks not to be able to deploy these along with your application.</p>

<h2>Useful links</h2>

<ul>
<li><a href="http://www.ibm.com/developerworks/java/library/j-jws16/">http://www.ibm.com/developerworks/java/library/j-jws16/</a></li>
</ul>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">David Bilge</span></span>

      








  


<time datetime="2012-08-19T13:25:00+02:00" pubdate data-updated="true">Aug 19<span>th</span>, 2012</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/cxf/'>CXF</a>, <a class='category' href='/blog/categories/java/'>Java</a>, <a class='category' href='/blog/categories/soap/'>SOAP</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://davidbilge.github.com/blog/2012/08/19/building-a-cxf-client-for-a-wcf-webservice-with-secureconversation/" data-via="" data-counturl="http://davidbilge.github.com/blog/2012/08/19/building-a-cxf-client-for-a-wcf-webservice-with-secureconversation/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
      
        <a class="basic-alignment right" href="/blog/2013/01/04/setting-up-an-octopress-blog-on-github/" title="Next Post: Setting up an Octopress blog on github from OSX">Setting up an Octopress blog on github from OSX &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/01/04/setting-up-an-octopress-blog-on-github/">Setting up an Octopress blog on github from OSX</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/08/19/building-a-cxf-client-for-a-wcf-webservice-with-secureconversation/">Building a CXF client for a WCF webservice with SecureConversation</a>
      </li>
    
  </ul>
</section>






  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - David Bilge -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
